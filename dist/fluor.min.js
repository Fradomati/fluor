const n={append:"push",prepend:"unshift",pop:"pop",shift:"shift"};function t(n,t=document){return n instanceof Node?[n]:t.querySelectorAll(n)}function o(n,t=document){return n instanceof Node?n:t.querySelector(n)}function c(){return Math.random().toString(36).slice(2)}function e(n){return Array.isArray(n)?n.join(" "):"string"==typeof n?n:Object.entries(n).reduce((n,[t,o])=>o?n.concat(t):n,[])}function s(n,t){return n.split(".").reduce((n,t)=>n[t],t)}function f(n,t,o){return c=n,Boolean(c&&c.constructor&&c.call&&c.apply)?n(t,o):n;var c}function r(n,t){const o=[n];for(;o.length;){const n=o.shift();!1!==t(n)&&Array.from(n.children,n=>o.push(n))}}function u(n){if(!m.t.size)return null;let t=n;for(;t;){if(m.t.has(t))return m.t.get(t);t=t.parentElement}return null}function i(n,t,o){const e=s(n.value,o);if(t.o){const n=[...new Set(t.o.map(n=>n.molecule))];for(const t of n)t.$root.parentElement.removeChild(t.$root),p(t);t.o=null}if(e&&!t.o){const n=document.createDocumentFragment(),o=t.content.cloneNode(!0);t.o=[];for(const c of[...o.children])t.o.push({child:c}),n.append(c);t.parentNode.insertBefore(n,t.nextSibling);for(const n of t.o){const{child:t}=n,o=d(c(),t);n.molecule=o,m.t.set(t,o),b(t),o.render()}}}function a(n,t,o){const[e,f]=n.value.split(/\s+in\s+/),r=s(f,o),u=document.createDocumentFragment();if(t.s){const c=[...new Set(t.s.map(n=>n.molecule))];for(const n of c)n.$root.parentElement.removeChild(n.$root),p(n);t.s=null,a(n,t,o)}else{t.s=[];for(let n=0,o=r.length;n<o;n++){const o=t.content.cloneNode(!0);for(const c of[...o.children])t.s.push({index:n,child:c}),u.append(c)}t.parentNode.insertBefore(u,t.nextSibling);for(const n of t.s){const{index:t,child:o}=n,s=d(c(),o);s.setup({$index:t,[e]:r[t]}),n.molecule=s,m.t.set(o,s),b(o),s.render()}}}function l(n,t,o){const[c,e]=n.value.split(":"),f=s(e,o);switch(f){case!0:t.setAttribute(c,"");break;case!1:t.removeAttribute(c);break;default:t.setAttribute(c,f)}}function d(c,d){const p={},h=n=>Object.assign(p,n),m=d?u(d.parentElement):null;function b(n=!0){const t=u(d);r(d,o=>{const c=u(o);if(c!==t)return n&&c.render(n),!1;for(const n of o.attributes)switch(n.name){case"f-text":o.textContent=s(n.value,p);break;case"f-html":o.innerHTML=s(n.value,p);break;case"f-if":i(n,o,p);break;case"f-each":a(n,o,p);break;case"f-bind":l(n,o,p)}})}function $(n,t){h("object"==typeof n?Object.entries(n).reduce((n,[t,o])=>({...n,[t]:f(o,p[t],p)}),{}):{[n]:f(t,p[n],p)})}function w(n,o,c=null){return e=>{(c?t(c,d):[e.currentTarget]).forEach(t=>t.classList[n](o))}}return m&&h({$parent:m.$data}),{set:(n,t)=>()=>{$(n,t),b()},setup(n,t){$(n,t)},on(n,o,c){const e=Array.isArray(c)?n=>c.forEach(t=>t(n)):c;for(const c of t(o,d))u(c).$root===d&&c.addEventListener(n,e)},addClass:(n,t=null)=>w("add",n,t),removeClass:(n,t=null)=>w("remove",n,t),toggleClass:(n,t=null)=>w("toggle",n,t),...Object.entries(n).reduce((n,[t,o])=>({...n,[t]:(n,t)=>()=>{p[n][o](f(t,p[n],p)),b()}}),{}),withEvent:n=>t=>n(t)(),render:b,classes:e,$data:p,$id:c,$root:d,$parent:m,$:(n,o=d)=>t(n,o),$$:(n,t=d)=>o(n,t)}}function p(n){const t=m.u.get(n)||[];for(const n of t)n.parentElement.removeChild(n)}const h=Object.keys(d());function m(n,t){const o=Array.from(m.t.values()).find(t=>t.$id===n);t(o),o.render(!1)}function b(n){const t=[],o=[];r(n,n=>{"SCRIPT"===n.tagName&&"fluor"===n.type&&t.push(n)});for(const n of t){const t=n.parentElement;let e;if(m.t.has(t))e=m.t.get(t);else{e=d(c(),t),m.t.set(t,e)}n.i=e,o.push(e)}const e=document.createDocumentFragment();for(const n of t){const t=n.i,o=document.createElement("script"),c=`Fluor("${t.$id}", ({${h.join(",")}}) => {${n.textContent}})`;o.textContent=c,n.parentElement.removeChild(n),m.u.has(t)?m.u.set(t,[...m.u.get(t),o]):m.u.set(t,[o]),e.appendChild(o)}document.body.appendChild(e)}window.Fluor=m,m.t=new Map,m.u=new Map,async function(){await new Promise(n=>{"loading"==document.readyState?document.addEventListener("DOMContentLoaded",n):n()}),b(document.body)}();export default function $(n,t){const e=o(n),s=c(),f=d(s,e);m.t.set(e,f),m(s,t)}