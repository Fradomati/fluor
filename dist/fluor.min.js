const n={append:"push",prepend:"unshift",pop:"pop",shift:"shift"};function t(n,t=document){return n instanceof Node?[n]:t.querySelectorAll(n)}function o(){return Math.random().toString(36).slice(2)}function e(n){return Array.isArray(n)?n.join(" "):"string"==typeof n?n:Object.entries(n).reduce((n,[t,o])=>o?n.concat(t):n,[])}function c(n,t){return n.split(".").reduce((n,t)=>n[t],t)}function r(n,t,o){return e=n,Boolean(e&&e.constructor&&e.call&&e.apply)?n(t,o):n;var e}function s(n,t){const o=[n];for(;o.length;){const n=o.shift();!1!==t(n)&&Array.from(n.children,n=>o.push(n))}}function f(n){if(!h.t.size)return null;let t=n;for(;t;){if(h.t.has(t))return h.t.get(t);t=t.parentElement}return null}function u(n,t,e){const r=c(n.value,e);if(t.o){const n=[...new Set(t.o.map(n=>n.molecule))];for(const t of n)t.$root.parentElement.removeChild(t.$root),d(t);t.o=null}if(r&&!t.o){const n=document.createDocumentFragment(),e=t.content.cloneNode(!0);t.o=[];for(const o of[...e.children])t.o.push({child:o}),n.append(o);t.parentNode.insertBefore(n,t.nextSibling);for(const n of t.o){const{child:t}=n,e=l(o(),t);n.molecule=e,h.t.set(t,e),m(t),e.render()}}}function i(n,t,e){const[r,s]=n.value.split(/\s+in\s+/),f=c(s,e),u=document.createDocumentFragment();if(t.s){const o=[...new Set(t.s.map(n=>n.molecule))];for(const n of o)n.$root.parentElement.removeChild(n.$root),d(n);t.s=null,i(n,t,e)}else{t.s=[];for(let n=0,o=f.length;n<o;n++){const o=t.content.cloneNode(!0);for(const e of[...o.children])t.s.push({index:n,child:e}),u.append(e)}t.parentNode.insertBefore(u,t.nextSibling);for(const n of t.s){const{index:t,child:e}=n,c=l(o(),e);c.setup({$index:t,[r]:f[t]}),n.molecule=c,h.t.set(e,c),m(e),c.render()}}}function a(n,t,o){const[e,r]=n.value.split(":"),s=c(r,o);switch(s){case!0:t.setAttribute(e,"");break;case!1:t.removeAttribute(e);break;default:t.setAttribute(e,s)}}function l(o,l){const d={},p=n=>Object.assign(d,n),h=l?f(l.parentElement):null;function m(n=!0){const t=f(l);s(l,o=>{const e=f(o);if(e!==t)return n&&e.render(n),!1;for(const n of o.attributes)switch(n.name){case"f-text":o.textContent=c(n.value,d);break;case"f-html":o.innerHTML=c(n.value,d);break;case"f-if":u(n,o,d);break;case"f-each":i(n,o,d);break;case"f-bind":a(n,o,d)}})}function b(n,t){p("object"==typeof n?Object.entries(n).reduce((n,[t,o])=>({...n,[t]:r(o,d[t],d)}),{}):{[n]:r(t,d[n],d)})}function $(n,o,e=null){return c=>{(e?t(e,l):[c.currentTarget]).forEach(t=>t.classList[n](o))}}return h&&p({$parent:h.$data}),{set:(n,t)=>()=>{b(n,t),m()},setup(n,t){b(n,t)},on(n,o,e){const c=Array.isArray(e)?n=>e.forEach(t=>t(n)):e;for(const e of t(o,l))f(e).$root===l&&e.addEventListener(n,c)},addClass:(n,t=null)=>$("add",n,t),removeClass:(n,t=null)=>$("remove",n,t),toggleClass:(n,t=null)=>$("toggle",n,t),...Object.entries(n).reduce((n,[t,o])=>({...n,[t]:(n,t)=>()=>{d[n][o](r(t,d[n],d)),m()}}),{}),withEvent:n=>t=>n(t)(),render:m,classes:e,$data:d,$id:o,$root:l,$parent:h,$:(n,o=l)=>t(n,o),$$:(n,t=l)=>function(n,t=document){return n instanceof Node?n:t.querySelector(n)}(n,t)}}function d(n){const t=h.u.get(n)||[];for(const n of t)n.parentElement.removeChild(n)}const p=Object.keys(l());function h(n,t){t(Array.from(h.t.values()).find(t=>t.$id===n))}function m(n){const t=[],e=[];s(n,n=>{"SCRIPT"===n.tagName&&"fluor"===n.type&&t.push(n)});for(const n of t){const t=n.parentElement;let c;if(h.t.has(t))c=h.t.get(t);else{c=l(o(),t),h.t.set(t,c)}n.i=c,e.push(c)}const c=document.createDocumentFragment();for(const n of t){const t=n.i,o=document.createElement("script"),e=`Fluor("${t.$id}", ({${p.join(",")}}) => {${n.textContent}; render(false)})`;o.textContent=e,n.parentElement.removeChild(n),h.u.has(t)?h.u.set(t,[...h.u.get(t),o]):h.u.set(t,[o]),c.appendChild(o)}document.body.appendChild(c)}window.Fluor=h,h.t=new Map,h.u=new Map,async function(){await new Promise(n=>{"loading"==document.readyState?document.addEventListener("DOMContentLoaded",n):n()}),m(document.body)}();